---
title: "Assignment 4 - A working Title"
author: "Anthony Luna & Elliott Matthews"
date: "11/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r}
library(tidyverse)
library(janitor)
library(kableExtra)
library(scales)
library(here)
```

### Introduction

### Data and Methods

### Results

#### Results A: Visually Explore changes in annual lobster abundance (counts) by site 

```{r}
lob_raw <- read_csv(here("data","lobster_abundance_sbc_lter.csv"), na = "-99999") %>% 
  clean_names() %>% 
  uncount(weights = count) %>% 
  mutate(cfgn_code = case_when(site %in% c("NAPL","IVEE")~"MPA",TRUE~"non-MPA"))


lob_year_site <- lob_raw %>% 
  group_by(year,site, cfgn_code) %>% 
  summarise(count = n()) 

lob_year_site_plot <- ggplot(data=lob_year_site, aes(x=year,y=count))+
  geom_line(aes(color = site))+
  facet_wrap(~cfgn_code, nrow = 2)+
  labs(title = "Population of Lobsters over time",
    subtitle = "2012-2018",
    caption = "Observed lobster counts from 2012 to 2018 in 5 locations off the coast of Santa Barbara",
    x = "Year",
    y = "Count of Lobsters",
    col = "Site") + 
    theme_minimal() +  
    # This centers our title and subtitle  
    theme(plot.title = element_text(hjust= 0.5),
          plot.subtitle = element_text(hjust= 0.5))
lob_year_site_plot
```



#### Results B: Visually explore lobster size distribution shifts by comparing lobster sizes in 2012 and 2018

```{r}
lob_size_2018 <- lob_raw %>% 
  filter(!is.na(size_mm)) %>% 
  filter(year==2018) 

ggplot(lob_size_2018,aes(x=size_mm,fill=year))+
  geom_histogram( color="#e9ecef", alpha=0.6, position = 'identity') +
   # scale_fill_manual(values=c("#69b3a2", "#404080")) +
  facet_wrap(~site,scales = "free")
```
```{r}
lob_size_2012 <- lob_raw %>%    ######## would consider renaming lob_size_2012
  filter(!is.na(size_mm)) %>% 
  filter(year==2012) 

ggplot(lob_size_2012,aes(x=size_mm,fill=year))+
  geom_histogram( color="#e9ecef", alpha=0.6, position = 'identity') +
  facet_wrap(~site)
```


#### Results C: Compare mean lobster sizes at MPA vs. non-MPA status sites in 2012 and 2018

```{r}
### Create data frames for statistical analysis. ###

# Mean size of lobsters in 2012

mpa_size_2012 <- lob_raw %>% 
  filter(year == 2012) %>%
  filter(cfgn_code == "MPA") %>% 
  filter(!is.na(size_mm)) 

non_mpa_size_2012 <- lob_raw %>% 
  filter(year == 2012) %>%
  filter(cfgn_code == "non-MPA") %>% 
  filter(!is.na(size_mm)) 

# Mean size of lobsters in 2018

mpa_size_2018 <- lob_raw %>% 
  filter(year == 2018) %>%
  filter(cfgn_code == "MPA" ) %>% 
  filter(!is.na(size_mm)) 

non_mpa_size_2018 <- lob_raw %>% 
  filter(year == 2018) %>%
  filter(cfgn_code == "non-MPA") %>% 
  filter(!is.na(size_mm))

### Perform t-tests on data to determine if there is a significant difference between lobster sites in:

# 1. 2012 MPA and non MPA sites 

mpa_vs_non_2012 <- t.test(
  mpa_size_2012$size_mm, non_mpa_size_2012$size_mm)

# 2. 2018 MPA and non MPA sites

mpa_vs_non_2018 <- t.test(
  mpa_size_2018$size_mm, non_mpa_size_2018$size_mm)

# 3. MPA sites only 2012 vs 2018

mpa_2012_vs_mpa_2018 <- t.test(
  mpa_size_2012$size_mm, mpa_size_2018$size_mm)

# 4. non MPA sites only 2012 vs 2018

non_mpa_2012_vs_non_mpa_2018 <- t.test(
  non_mpa_size_2012$size_mm, non_mpa_size_2018$size_mm)

#mpa_vs_non_2012


```

```{r}
### Create summary table with mean, standard deviation, and sample count

final_summary_table <- lob_raw %>% 
  filter(year %in% c(2012, 2018)) %>% 
  group_by(cfgn_code,year) %>% 
  summarize(
    mean = mean(size_mm),
    s_dev = sd(size_mm),
    count = n())

kableExtra::kable(final_summary_table, 
                  caption = "Table 1: Lobster summary statistics",
                  col.names = c("Area Type",
                                "Year",
                                "Mean (mm)",
                                "Standard Deviation (\u00B1 mm)  ",
                                "Count"))
  
```


### Summary

### References